## 高级代码要先编译再执行

高级代码语言指的是 C++，Java，JavaScript 这种语言。因为 CPU 处理器只能识别二进制，所以高级语言需要被转化成二进制代码才能执行，这个转化的过程就是编译。目前有两种编译方式：解释执行和编译执行

### 解释执行

需要将源代码通过解析器编译成中间代码，之后直接使用解释器解释执行中间代码。

### 编译执行

先将源代码转换为中间代码，然后再使用编译器贾昂中间代码编译成二进制机器码。通常编译成的机器码是以二进制文件形式存储的，需要执行这段程序的时候直接执行二进制文件即可。

## V8 是怎么执行 JavaScript 代码的

V8 混合使用了编译执行和解释执行两种手段，我们称为 JIT（Just In Time）。因为解释执行启动快，执行慢，编译执行启动慢，执行快。

![v8执行js流程图](/img/v8执行js流程图.png)

- 在 V8 启动执行 js 之前，需要准备执行 js 时所需要的一些基础环境，包括”堆空间“，”栈空间“，”全局执行上下文“，”全局作用域“，”消息循环系统“，”内置函数“等；

- 在词法分析和语法分析后生成 AST（抽象语法树）和相关作用域，作用域中存放相关变量；
- 基于 AST 和作用域生成字节码（字节码是介于 AST 和机器码的中间代码）；
- 解释器按照顺序执行字节码，并输出执行结果（在执行过程中，如果某段代码重复多次，会被标记为热点代码，热点代码会被优化编译器编译成二进制机器码，后续再执行这段代码，就会直接执行机器码了）；
- 因为 js 不是静态语言，对象的结构和属性可以在运行时任意修改，所以在执行过程中，如果对象结构被动态修改，优化编译器就需要执行反优化，下次执行时就会回退到解释器解释执行；
